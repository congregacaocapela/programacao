<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Programação — Reunião (App)</title>

<!-- PWA Configuration -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3a2b54">
<link rel="apple-touch-icon" href="icon-192.png">

<!-- Favicon -->
<link rel="icon" type="image/png" href="favicon.png">
<link rel="icon" type="image/jpeg" href="favicon.jpg">

<!-- CSS -->
<style>
:root{
  --bg:#f6f5f3;
  --accent:#2b6b63; 
  --header:#fff5f7; 
  --primary:#3a2b54; 
  --section1:#2f6f73; 
  --section2:#9a6a28; 
  --section3:#7a2520; 
  --card:#ffffff;
  --muted:#707070;
  --green:#26a65b;
  --blue:#2d6bd6;
  --red:#c73b3b;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
body{margin:0;background:var(--bg);color:#111; -webkit-tap-highlight-color: transparent;}

/* HEADER AJUSTADO */
.app-header{
  background:var(--primary);
  color:white;
  padding:12px 16px;
  display:flex;
  align-items:center;
  justify-content: space-between; /* Título na esq, Botões na dir */
  min-height: 60px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.app-header button{
  background:transparent; border:0; color:white;
  padding: 8px; 
  display: flex; align-items: center; justify-content: center;
}
.title{
  font-size:18px; font-weight:800; text-transform: uppercase; letter-spacing: 0.5px;
  white-space: nowrap; /* Não quebra linha */
}
.header-actions {
  display: flex; gap: 8px; align-items: center;
}

.container{padding:10px; max-width: 800px; margin: 0 auto; padding-bottom: 80px;}

/* CARD */
.card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}

/* DATA WRAPPER FIX FOR MOBILE */
.date-wrapper {
  position: relative;
  text-align: center;
  margin-bottom: 8px;
}
.date {
  font-weight:800; font-size:18px; 
  border-bottom: 1px dashed #ccc; 
  display: inline-block;
  padding-bottom: 2px;
  color: var(--primary);
}
.date-input-overlay {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  opacity: 0;
  cursor: pointer;
  z-index: 10;
}

.sub{font-weight:700;color:var(--muted);text-align:center;margin-bottom:12px; font-size: 14px;}

/* SECTIONS */
.section-block { margin-bottom: 24px; }
.section-title{
  color:white; padding:10px; border-radius:6px; 
  font-weight:800; text-align:center; margin-bottom:10px;
  font-size: 15px; text-transform: uppercase;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.section-title.t1{background:var(--section1)}
.section-title.t2{background:var(--section2)}
.section-title.t3{background:var(--section3)}

/* PART ITEM */
.part{
  background: white;
  border-radius: 10px;
  border: 1px solid #eee;
  margin-bottom: 12px;
  padding: 12px;
  display: flex;
  gap: 10px;
  align-items: flex-start;
  box-shadow: 0 1px 3px rgba(0,0,0,0.03);
}
.left{width:6px; border-radius: 4px; background: #eee; align-self: stretch;}

.content{flex:1; min-width: 0;}

.part-top{
  display:flex; justify-content:space-between; align-items:flex-start; gap:8px;
  margin-bottom: 10px;
}
.part-number{font-weight:800; font-size: 15px; margin-right: 4px; white-space: nowrap;}

textarea.title-input {
  width: 100%;
  border: none;
  font-weight: 700;
  font-size: 16px;
  resize: none;
  overflow: hidden;
  padding: 0;
  font-family: inherit;
  color: #111;
  background: transparent;
  line-height: 1.4;
  min-height: 22px;
}
textarea.title-input:focus { outline: none; border-bottom: 1px solid var(--primary); }

.meta{font-size:12px; color:var(--muted); margin-top: 2px;}

.part-row{
  display:flex; gap:8px; align-items:center; flex-wrap:wrap;
}

input[type="time"], select {
  padding:10px 8px; 
  border-radius:8px; border:1px solid #ddd; 
  background: #fff;
  font-size: 15px;
  height: 40px;
}
input[type="time"] { width: 85px; text-align: center; }

select.name-select {
  flex: 1;
  min-width: 140px;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}

.duration{
  font-weight:800; padding:0 10px; 
  border-radius:8px; background:#f0f0f0; 
  height: 40px; line-height: 40px;
  font-size: 14px;
  min-width: 70px; text-align: center;
}
.duration.live { color: white; background: var(--red); animation: pulse-text 1s infinite; }

.btn-timer {
  background: var(--green); color: white; border: 0; 
  width: 40px; height: 40px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 16px;
  flex-shrink: 0;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
}
.btn-timer.running { background: var(--red); animation: pulse 2s infinite; }

.remove{
  background:transparent; border:0; color:var(--red); 
  font-weight:800; font-size:20px; padding: 4px 8px;
}

.btn.add-small{
  background:#f8f9fa; color:#333; font-size:14px; padding: 12px;
  width:100%; margin-top:4px; border: 1px dashed #ccc; border-radius: 8px;
}
.btn.pdf{
  background:var(--accent); color:white; padding: 14px; 
  border-radius: 10px; width: 100%; font-size: 16px; 
  box-shadow: 0 4px 10px rgba(43, 107, 99, 0.3);
}

.badge{background:#fff;padding:6px 12px;border-radius:20px;box-shadow:0 2px 5px rgba(0,0,0,0.08);font-weight:600;font-size:12px; white-space: nowrap;}

/* MODAL */
.modal-overlay { z-index: 999; }
.modal { width: 90%; max-width: 350px; padding: 24px; border-radius: 16px; }
.add-name-row input { padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; }
.btn.add { padding: 0 16px; border-radius: 8px; }

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(199, 59, 59, 0.7); }
  70% { box-shadow: 0 0 0 8px rgba(199, 59, 59, 0); }
  100% { box-shadow: 0 0 0 0 rgba(199, 59, 59, 0); }
}

@media(max-width: 400px) {
  .part-row { gap: 6px; }
  input[type="time"] { width: 75px; font-size: 13px; }
  .btn-timer { width: 36px; height: 36px; }
  .duration { min-width: 60px; font-size: 13px; }
  select.name-select { width: 100%; flex-basis: 100%; margin-top: 4px; }
}
</style>
</head>
<body>

<header class="app-header">
  <div class="title">PROGRAMAÇÃO</div>
  <div class="header-actions">
    <button onclick="openResetModal()" title="Limpar">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
    <button onclick="openSettings()" title="Nomes">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
    </button>
    <button onclick="exportPDF()" title="PDF">PDF ⤓</button>
  </div>
</header>

<div class="container">

  <div class="card">
    <div class="date-wrapper">
      <div class="date" id="dateLabel">quarta-feira, 26 de novembro de 2025</div>
      <input type="date" id="dateHidden" class="date-input-overlay" onchange="updateDateFromPicker(this)">
    </div>
    
    <div class="sub" id="subLabel" contenteditable="true">ISAÍAS 1-2</div>

    <div style="margin-top:12px">
      <div style="font-size:14px; color:var(--muted); margin-bottom:4px;">Presidente</div>
      <div style="display:flex;align-items:center;gap:8px;">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#26a65b"></circle><path d="M8 13l2.5 2.5L16 10" stroke="#fff" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <select id="presidente" class="name-select" onchange="scheduleSave()">
          <option value="">Selecione...</option>
        </select>
      </div>
      
      <div style="font-size:14px; color:var(--muted); margin-bottom:4px; margin-top:12px;">Dirigente (Sala B)</div>
      <div style="display:flex;align-items:center;gap:8px;">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#26a65b"></circle><path d="M8 13l2.5 2.5L16 10" stroke="#fff" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <select id="dirigente" class="name-select" onchange="scheduleSave()">
           <option value="">Selecione...</option>
        </select>
      </div>
    </div>
  </div>

  <div class="section-block" id="block-t1">
    <div class="section-title t1">TESOUROS DA PALAVRA DE DEUS</div>
    <div class="parts-container" id="area-t1"></div>
    <button class="btn add-small" onclick="addPart('t1')">+ Adicionar</button>
  </div>

  <div class="section-block" id="block-t2">
    <div class="section-title t2">FAÇA SEU MELHOR NO MINISTÉRIO</div>
    <div class="parts-container" id="area-t2"></div>
    <button class="btn add-small" onclick="addPart('t2')">+ Adicionar</button>
  </div>

  <div class="section-block" id="block-t3">
    <div class="section-title t3">NOSSA VIDA CRISTÃ</div>
    <div class="parts-container" id="area-t3"></div>
    <button class="btn add-small" onclick="addPart('t3')">+ Adicionar</button>
  </div>

  <div style="display:flex; gap:12px; align-items:center; margin-top:30px; margin-bottom: 20px;">
    <button class="btn pdf" onclick="exportPDF()">Salvar PDF</button>
  </div>
  <div style="text-align:center;">
    <div class="badge" id="savedBadge">Carregando...</div>
  </div>

</div>

<!-- Modals -->
<div id="settingsModal" class="modal-overlay">
  <div class="modal">
    <span class="modal-close" onclick="closeSettings()">✕</span>
    <h2>Nomes</h2>
    <p style="color:var(--muted); font-size:14px;">Adicione nomes (separados por vírgula).</p>
    <div class="add-name-row">
      <input type="text" id="newPersonName" placeholder="Ex: Ana, Bruno..." onkeydown="if(event.key==='Enter') addNameToList()">
      <button class="btn add" onclick="addNameToList()">OK</button>
    </div>
    <div class="name-list" id="namesContainer"></div>
  </div>
</div>

<div id="confirmModal" class="modal-overlay" style="z-index: 200;">
  <div class="modal">
    <span class="modal-close" onclick="closeConfirmModal()">✕</span>
    <h2>Reiniciar?</h2>
    <p>Substituir o horário anterior?</p>
    <div style="display:flex; gap:10px; margin-top:20px; justify-content:flex-end;">
      <button class="btn" style="background:#eee; color:#333;" onclick="closeConfirmModal()">Não</button>
      <button class="btn" style="background:var(--red); color:white;" onclick="confirmRestart()">Sim, Reiniciar</button>
    </div>
  </div>
</div>

<div id="resetConfirmModal" class="modal-overlay" style="z-index: 210;">
  <div class="modal">
    <span class="modal-close" onclick="closeResetModal()">✕</span>
    <h2 style="color:var(--red)">Limpar Tudo?</h2>
    <p>Apagar horários, cronômetros e nomes? (Partes serão mantidas)</p>
    <div style="display:flex; gap:10px; margin-top:20px; justify-content:flex-end;">
      <button class="btn" style="background:#eee; color:#333;" onclick="closeResetModal()">Cancelar</button>
      <button class="btn" style="background:var(--red); color:white;" onclick="confirmResetAll()">Limpar</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion, arrayRemove, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDPg0IN98UOgw0qs7bHKt9m9EBde0c74Sc",
    authDomain: "gustavo-e27c9.firebaseapp.com",
    projectId: "gustavo-e27c9",
    storageBucket: "gustavo-e27c9.firebasestorage.app",
    messagingSenderId: "601135742894",
    appId: "1:601135742894:web:656052a144d076e57c523f",
    measurementId: "G-6B5BKTXJBD"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  try { enableIndexedDbPersistence(db).catch(console.log); } catch(e){}

  let currentUser = null;
  const appId = "programa_reuniao_app"; 

  signInAnonymously(auth).catch((error) => {
    document.getElementById('savedBadge').innerText = "Erro Login";
  });

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      document.getElementById('savedBadge').innerText = "Conectado";
      initDataListeners(user.uid);
    }
  });

  function initDataListeners(uid) {
    const userDocRef = doc(db, "artifacts", appId, "users", uid, "data", "program_v2");
    const namesDocRef = doc(db, "artifacts", appId, "users", uid, "settings", "names");

    onSnapshot(namesDocRef, (docSnap) => {
      let names = [];
      if (docSnap.exists() && docSnap.data().list) names = docSnap.data().list.sort();
      window.currentNamesList = names;
      updateAllNameSelects();
      updateSettingsModal(names);
    });

    onSnapshot(userDocRef, (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        if(!isEditing) loadFromState(data);
        document.getElementById('savedBadge').innerText = "Sincronizado";
      } else {
         loadDefaultParts();
         saveToFirebase();
      }
    });
  }

  window.currentNamesList = [];

  window.updateAllNameSelects = function() {
    document.querySelectorAll('select.name-select').forEach(sel => {
        const currentVal = sel.value;
        sel.innerHTML = '<option value="">Selecione...</option>';
        window.currentNamesList.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name; opt.innerText = name;
            sel.appendChild(opt);
        });
        sel.value = currentVal;
    });
  }

  function updateSettingsModal(names) {
    const ui = document.getElementById('namesContainer');
    ui.innerHTML = '';
    names.forEach(name => {
      const div = document.createElement('div');
      div.className = 'name-item';
      div.innerHTML = `<span>${name}</span> <button onclick="window.removeName('${name}')">Excluir</button>`;
      ui.appendChild(div);
    });
  }

  window.addNameToList = async function() {
    const input = document.getElementById('newPersonName');
    const namesToAdd = input.value.split(',').map(n => n.trim()).filter(n => n.length > 0);
    if (!namesToAdd.length || !currentUser) return;
    try {
      await setDoc(doc(db, "artifacts", appId, "users", currentUser.uid, "settings", "names"), 
        { list: arrayUnion(...namesToAdd) }, { merge: true });
      input.value = '';
    } catch (e) {}
  }

  window.removeName = async function(name) {
    if (!currentUser) return;
    try { await updateDoc(doc(db, "artifacts", appId, "users", currentUser.uid, "settings", "names"), 
      { list: arrayRemove(name) }); } catch (e) {}
  }

  let saveTimer = null;
  let isEditing = false;
  window.scheduleSave = function() {
    isEditing = true;
    document.getElementById('savedBadge').innerText = 'Salvando...';
    clearTimeout(saveTimer);
    saveTimer = setTimeout(() => { saveToFirebase(); isEditing = false; }, 1500);
  }

  async function saveToFirebase() {
    if (!currentUser) return;
    const state = {
      dateLabel: document.getElementById('dateLabel').innerText,
      subLabel: document.getElementById('subLabel').innerText,
      presidente: document.getElementById('presidente').value,
      dirigente: document.getElementById('dirigente').value,
      parts: getParts()
    };
    try {
      await setDoc(doc(db, "artifacts", appId, "users", currentUser.uid, "data", "program_v2"), state);
      document.getElementById('savedBadge').innerText = "Salvo na Nuvem";
      setTimeout(() => { if(document.getElementById('savedBadge').innerText === "Salvo na Nuvem") document.getElementById('savedBadge').innerText = "Sincronizado"; }, 2000);
    } catch (e) {}
  }

  window.getParts = function() {
    return Array.from(document.querySelectorAll('.part')).map(p => {
      const id = p.getAttribute('data-id');
      const parentId = p.parentElement.id; 
      let section = 't1';
      if(parentId === 'area-t2') section = 't2';
      if(parentId === 'area-t3') section = 't3';
      
      const sInput = document.getElementById('start-'+id);
      const startTs = sInput.dataset.startTs || null;

      return {
        id, section,
        title: document.getElementById('title-'+id).value, 
        start: sInput.value,
        end: document.getElementById('end-'+id).value,
        name: document.getElementById('name-'+id).value,
        startTs: startTs
      }
    });
  }

  window.loadFromState = function(state) {
    if(!state) return;
    document.getElementById('dateLabel').innerText = state.dateLabel || 'Data...';
    document.getElementById('subLabel').innerText = state.subLabel || 'Tema...';
    document.getElementById('presidente').value = state.presidente || '';
    document.getElementById('dirigente').value = state.dirigente || '';

    ['t1','t2','t3'].forEach(s => document.getElementById('area-'+s).innerHTML = '');
    
    (state.parts || []).forEach(p => {
       let sec = p.section;
       if(!sec) sec = (parseInt(p.id)<=3)?'t1':(parseInt(p.id)<=6)?'t2':'t3';
       renderPart(p, sec);
    });
    
    state.parts.forEach(p => {
        updateDuration(p.id);
        updateTimerButtonState(p.id); 
    });
  }

  window.loadDefaultParts = function() {
    renderPart({id:1, title:'Esperança para os que estão...', section:'t1'}, 't1');
    renderPart({id:2, title:'Joias espirituais', section:'t1'}, 't1');
    renderPart({id:3, title:'Leitura da Bíblia', section:'t1'}, 't1');
    renderPart({id:4, title:'Iniciando conversas', section:'t2'}, 't2');
    renderPart({id:5, title:'Cultivando o interesse', section:'t2'}, 't2');
    renderPart({id:6, title:'Discurso', section:'t2'}, 't2');
    renderPart({id:7, title:'Estudo Bíblico', section:'t3'}, 't3');
  }

  window.getOptionsHtml = function(selectedName) {
    let html = '<option value="">Selecione...</option>';
    (window.currentNamesList || []).forEach(name => {
        html += `<option value="${name}" ${name===selectedName?'selected':''}>${name}</option>`;
    });
    return html;
  }

  function renderPart(data, sectionId) {
      const container = document.getElementById('area-'+sectionId);
      if(!container) return; 
      const div = document.createElement('div');
      div.className = 'part';
      div.setAttribute('data-id', data.id);
      
      div.innerHTML = `
        <div class="left"><div style="width:100%;height:100%;background:${
          sectionId==='t1'?'var(--section1)':sectionId==='t2'?'var(--section2)':'var(--section3)'
        }"></div></div>
    <div class="content">
      <div class="part-top">
        <div style="flex:1; display:flex; gap:2px; align-items:flex-start;">
          <div class="part-number">${data.id}.</div> 
          <textarea class="title-input" id="title-${data.id}" rows="1" oninput="autoResize(this); window.scheduleSave()">${data.title || ''}</textarea>
        </div>
        <div class="actions"><button class="remove" onclick="removePart(${data.id})">✕</button></div>
      </div>
      <div class="part-row">
        <button class="btn-timer" id="btn-timer-${data.id}" onclick="window.toggleTimer(${data.id})">▶</button>
        <input type="time" id="start-${data.id}" onchange="this.removeAttribute('data-start-ts'); window.updateDuration(${data.id})">
        <input type="time" id="end-${data.id}" onchange="window.updateDuration(${data.id})">
        <select id="name-${data.id}" class="name-select" onchange="window.scheduleSave()">${window.getOptionsHtml(data.name || '')}</select>
        <div class="duration" id="dur-${data.id}">--</div>
      </div>
    </div>
  `;
  container.appendChild(div);
  setTimeout(() => autoResize(document.getElementById('title-'+data.id)), 0);
}

// Auto Resize Textarea logic
window.autoResize = function(elem) {
  elem.style.height = 'auto';
  elem.style.height = elem.scrollHeight + 'px';
}

function removePart(id){
  document.querySelector('.part[data-id="'+id+'"]')?.remove();
  window.scheduleSave();
}
function toMinutes(t){
  if(!t) return null;
  const [hh,mm] = t.split(':').map(Number);
  return hh*60+mm;
}

// Global Interval for Live Timers
setInterval(() => {
    document.querySelectorAll('.part').forEach(part => {
        const id = part.getAttribute('data-id');
        const sInput = document.getElementById('start-' + id);
        const e = document.getElementById('end-' + id)?.value;
        const out = document.getElementById('dur-' + id);
        
        if (sInput?.value && !e && out) {
            out.classList.add('live');
            
            if (sInput.dataset.startTs) {
                const startTs = parseInt(sInput.dataset.startTs);
                const diffMs = Date.now() - startTs;
                const diffSecs = Math.max(0, Math.floor(diffMs / 1000));
                const mm = Math.floor(diffSecs / 60);
                const ss = diffSecs % 60;
                out.innerText = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
            } 
            else {
                const [sh, sm] = sInput.value.split(':').map(Number);
                const now = new Date();
                const start = new Date();
                start.setHours(sh, sm, 0, 0);
                let diffMs = now - start;
                if (diffMs < 0) diffMs += 24 * 60 * 60 * 1000;
                const diffSecs = Math.floor(diffMs / 1000);
                const mm = Math.floor(diffSecs / 60);
                const ss = diffSecs % 60;
                out.innerText = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
            }
        }
    });
}, 1000);

window.updateDateFromPicker = function(input) {
    if (!input.value) return;
    const date = new Date(input.value + 'T12:00:00'); 
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const formatted = date.toLocaleDateString('pt-BR', options);
    document.getElementById('dateLabel').innerText = formatted;
    window.scheduleSave();
}

if ('serviceWorker' in navigator && (window.location.protocol === 'http:' || window.location.protocol === 'https:')) {
  navigator.serviceWorker.register('./sw.js').catch(console.error);
}
function exportPDF(){
  document.querySelectorAll('.btn.add-small').forEach(b => b.style.display = 'none');
  document.querySelectorAll('.btn-timer').forEach(b => b.style.display = 'none'); 
  const element = document.querySelector('.container');
  const opt = { margin: 0.2, filename: 'programacao_reuniao.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS:true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
  const badge = document.getElementById('savedBadge');
  const oldText = badge.innerText;
  badge.innerText = 'Gerando PDF...';
  html2pdf().from(element).set(opt).save().then(()=> {
    badge.innerText = 'PDF gerado';
    setTimeout(()=> badge.innerText = oldText, 2000);
    document.querySelectorAll('.btn.add-small').forEach(b => b.style.display = 'block');
    document.querySelectorAll('.btn-timer').forEach(b => b.style.display = 'flex'); 
  });
}
</script>
</body>
</html>
